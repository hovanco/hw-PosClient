{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/PosClient/src/features/dashboard/pages/sales-counters/state/orders-draft-context.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { Modal } from 'antd';\nimport { findIndex, isUndefined } from 'lodash';\nimport React, { createContext, useContext, useMemo } from 'react';\nimport { useImmerReducer } from 'use-immer';\nimport { types } from './types';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ORDER_ID_DEFAULT = Date.now();\nconst orderDefault = {\n  products: [],\n  payments: [],\n  customer: undefined,\n  shipment: 0,\n  customerNote: undefined,\n  moneyCustomer: 0,\n  isEdit: false,\n  delivered: false,\n  sale: false,\n  isRestrictAction: false,\n  createdBy: undefined,\n  id: ORDER_ID_DEFAULT\n};\nconst initialState = {\n  ordersDraft: [orderDefault],\n  orderIdDraftSelected: ORDER_ID_DEFAULT\n};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'update_orders':\n      {\n        const newOrdersDraft = state.ordersDraft.map(order => {\n          if (order.id === action.payload.id) {\n            return action.payload;\n          }\n\n          return order;\n        });\n        state.ordersDraft = newOrdersDraft;\n        return;\n      }\n\n    case types.ADD_ORDER_DRAFT:\n      {\n        const id = Date.now();\n        state.ordersDraft = [...state.ordersDraft, { ...orderDefault,\n          id\n        }];\n        state.orderIdDraftSelected = id;\n        return;\n      }\n\n    case types.CLOSE_ORDER_DRAFT:\n      {\n        if (state.orderIdDraftSelected === action.payload && state.ordersDraft.length > 1) {\n          const index = findIndex(state.ordersDraft, order => order.id === action.payload);\n\n          if (index + 1 === state.ordersDraft.length) {\n            state.orderIdDraftSelected = state.ordersDraft[index - 1].id;\n          } else {\n            state.orderIdDraftSelected = state.ordersDraft[index + 1].id;\n          }\n        }\n\n        state.ordersDraft = state.ordersDraft.filter(order => order.id !== action.payload);\n        return;\n      }\n\n    case types.SELECT_ORDER_DRAFT:\n      state.orderIdDraftSelected = action.payload;\n      return;\n\n    default:\n      return state;\n  }\n}\n\nconst intialContext = {\n  state: initialState,\n  dispatch: () => {}\n};\nconst Context = /*#__PURE__*/createContext(intialContext);\nexport const ProviderOrdersDraft = ({\n  children\n}) => {\n  _s();\n\n  const [state, dispatch] = useImmerReducer(reducer, initialState);\n  const value = useMemo(() => ({\n    state,\n    dispatch\n  }), [state, dispatch]);\n  return /*#__PURE__*/_jsxDEV(Context.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 12\n  }, this);\n};\n\n_s(ProviderOrdersDraft, \"gC2VGmEwTnbB1UxRsJQVzhdEP/g=\", false, function () {\n  return [useImmerReducer];\n});\n\n_c = ProviderOrdersDraft;\nexport function useOrdersDraft() {\n  _s2();\n\n  const {\n    state,\n    dispatch\n  } = useContext(Context);\n\n  function addOrderDraft() {\n    dispatch({\n      type: types.ADD_ORDER_DRAFT\n    });\n  }\n\n  function selectOrderDraft(orderId) {\n    dispatch({\n      type: types.SELECT_ORDER_DRAFT,\n      payload: orderId\n    });\n  }\n\n  function dispatchCloseOrderDraft(orderId) {\n    dispatch({\n      type: types.CLOSE_ORDER_DRAFT,\n      payload: orderId\n    });\n  }\n\n  function closeOrderDraft(order) {\n    if (!isUndefined(order.customer) || order.products.length > 0) {\n      Modal.confirm({\n        type: 'warning',\n        title: 'Bạn chắc chắn muốn hủy đơn hàng',\n\n        onCancel() {},\n\n        onOk() {\n          dispatchCloseOrderDraft(order.id);\n        },\n\n        okText: 'Hủy đơn',\n        cancelText: 'Thoát'\n      });\n    } else {\n      dispatchCloseOrderDraft(order.id);\n    }\n  }\n\n  function updateOrdersDraft(order) {\n    dispatch({\n      type: 'update_orders',\n      payload: order\n    });\n  }\n\n  return { ...state,\n    addOrderDraft,\n    selectOrderDraft,\n    updateOrdersDraft,\n    closeOrderDraft\n  };\n}\n\n_s2(useOrdersDraft, \"QMdo+h1+fLbTriZQ0QN6uukzyow=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"ProviderOrdersDraft\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/PosClient/src/features/dashboard/pages/sales-counters/state/orders-draft-context.tsx"],"names":["Modal","findIndex","isUndefined","React","createContext","useContext","useMemo","useImmerReducer","types","ORDER_ID_DEFAULT","Date","now","orderDefault","products","payments","customer","undefined","shipment","customerNote","moneyCustomer","isEdit","delivered","sale","isRestrictAction","createdBy","id","initialState","ordersDraft","orderIdDraftSelected","reducer","state","action","type","newOrdersDraft","map","order","payload","ADD_ORDER_DRAFT","CLOSE_ORDER_DRAFT","length","index","filter","SELECT_ORDER_DRAFT","intialContext","dispatch","Context","ProviderOrdersDraft","children","value","useOrdersDraft","addOrderDraft","selectOrderDraft","orderId","dispatchCloseOrderDraft","closeOrderDraft","confirm","title","onCancel","onOk","okText","cancelText","updateOrdersDraft"],"mappings":"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","sourcesContent":["import { Modal } from 'antd';\nimport { findIndex, isUndefined } from 'lodash';\nimport React, { createContext, FC, ReactNode, useContext, useMemo } from 'react';\nimport { useImmerReducer } from 'use-immer';\nimport { ICustomer } from '../../../../../collections/customer';\nimport { IAction } from '../../order/state';\nimport { Payment, ProductState } from './interface';\nimport { types } from './types';\n\nconst ORDER_ID_DEFAULT = Date.now();\n\ninterface IOrderDraft {\n    products: ProductState[];\n    payments: Payment[];\n    customer?: ICustomer;\n    shipment: number;\n    customerNote?: string;\n    moneyCustomer: number;\n    isEdit: boolean;\n    delivered: boolean;\n    sale: boolean;\n    isRestrictAction: boolean;\n    createdBy?: string;\n    id: number;\n}\n\nconst orderDefault: IOrderDraft = {\n    products: [],\n    payments: [],\n    customer: undefined,\n    shipment: 0,\n    customerNote: undefined,\n    moneyCustomer: 0,\n    isEdit: false,\n    delivered: false,\n    sale: false,\n    isRestrictAction: false,\n    createdBy: undefined,\n    id: ORDER_ID_DEFAULT,\n};\n\ninterface IState {\n    ordersDraft: IOrderDraft[];\n    orderIdDraftSelected: number;\n}\n\nconst initialState: IState = {\n    ordersDraft: [orderDefault],\n    orderIdDraftSelected: ORDER_ID_DEFAULT,\n};\n\nfunction reducer(state: IState, action: IAction) {\n    switch (action.type) {\n        case 'update_orders': {\n            const newOrdersDraft = state.ordersDraft.map((order) => {\n                if (order.id === action.payload.id) {\n                    return action.payload;\n                }\n\n                return order;\n            });\n\n            state.ordersDraft = newOrdersDraft;\n            return;\n        }\n\n        case types.ADD_ORDER_DRAFT: {\n            const id = Date.now();\n\n            state.ordersDraft = [\n                ...state.ordersDraft,\n                {\n                    ...orderDefault,\n                    id,\n                },\n            ];\n            state.orderIdDraftSelected = id;\n            return;\n        }\n\n        case types.CLOSE_ORDER_DRAFT: {\n            if (state.orderIdDraftSelected === action.payload && state.ordersDraft.length > 1) {\n                const index = findIndex(state.ordersDraft, (order) => order.id === action.payload);\n                if (index + 1 === state.ordersDraft.length) {\n                    state.orderIdDraftSelected = state.ordersDraft[index - 1].id;\n                } else {\n                    state.orderIdDraftSelected = state.ordersDraft[index + 1].id;\n                }\n            }\n\n            state.ordersDraft = state.ordersDraft.filter((order) => order.id !== action.payload);\n            return;\n        }\n\n        case types.SELECT_ORDER_DRAFT:\n            state.orderIdDraftSelected = action.payload;\n            return;\n\n        default:\n            return state;\n    }\n}\n\nconst intialContext = {\n    state: initialState,\n    dispatch: () => {},\n};\n\ninterface IContext {\n    state: IState;\n    dispatch: React.Dispatch<any>;\n}\n\nconst Context = createContext<IContext>(intialContext);\n\ninterface Props {\n    children: ReactNode;\n}\n\nexport const ProviderOrdersDraft: FC<Props> = ({ children }) => {\n    const [state, dispatch] = useImmerReducer(reducer, initialState);\n    const value = useMemo(() => ({ state, dispatch }), [state, dispatch]);\n    return <Context.Provider value={value}>{children}</Context.Provider>;\n};\n\nexport function useOrdersDraft() {\n    const { state, dispatch } = useContext(Context);\n\n    function addOrderDraft() {\n        dispatch({\n            type: types.ADD_ORDER_DRAFT,\n        });\n    }\n\n    function selectOrderDraft(orderId: number | string) {\n        dispatch({\n            type: types.SELECT_ORDER_DRAFT,\n            payload: orderId,\n        });\n    }\n\n    function dispatchCloseOrderDraft(orderId: string | number) {\n        dispatch({\n            type: types.CLOSE_ORDER_DRAFT,\n            payload: orderId,\n        });\n    }\n\n    function closeOrderDraft(order: IOrderDraft) {\n        if (!isUndefined(order.customer) || order.products.length > 0) {\n            Modal.confirm({\n                type: 'warning',\n                title: 'Bạn chắc chắn muốn hủy đơn hàng',\n                onCancel() {},\n                onOk() {\n                    dispatchCloseOrderDraft(order.id);\n                },\n                okText: 'Hủy đơn',\n                cancelText: 'Thoát',\n            });\n        } else {\n            dispatchCloseOrderDraft(order.id);\n        }\n    }\n\n    function updateOrdersDraft(order: IOrderDraft) {\n        dispatch({\n            type: 'update_orders',\n            payload: order,\n        });\n    }\n\n    return {\n        ...state,\n        addOrderDraft,\n        selectOrderDraft,\n        updateOrdersDraft,\n        closeOrderDraft,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}